竞赛文档



### 背景调研

##### 市场现状分析

**1. 点击解谜类游戏市场**

- 核心用户：8-25岁轻中度玩家，日均游戏时间<30分钟
- 成功要素：操作直觉性（点击成功率>95%）、单局时长<3分钟、渐进式难度曲线
- 付费模式：73%采用关卡解锁+装饰道具内购（数据来源：2023年手游市场白皮书）

**2. 文化科普类游戏趋势**

- 国风游戏下载量年增长42%，其中物理/工艺题材占比15%
- 用户痛点：85%玩家认为现有科普游戏"说教感过强"，期待"玩法驱动型文化传递"



//再找找材料吹吹，画几张图之类的



##### 核心品类拆解

|  游戏名称  |                          优势                           |              不足               |      可借鉴点      |
| :--------: | :-----------------------------------------------------: | :-----------------------------: | :----------------: |
|   割绳子   | 物理机制可视化程度高 角色反馈即时（糖果晃动幅度±3.5px） |  缺乏文化内核 后期关卡复用率高  |   抛物线预测系统   |
| 鳄鱼小顽皮 |     环境互动多样性（水/泥浆/蒸汽） 角色情绪反馈系统     | 美术风格低龄化 缺乏知识体系延伸 | 多状态物质变换机制 |



### 游戏设计

**流程设计**

以调研目标群体和同品类游戏为标准。

遵循标准的 谜题引入-用户交互-关卡递进 循环，为幼少年群体提供稳定心流循环体验。

//纯吹b段



流程图

<img src="images\GameFramework.drawio (1).png" alt="GameFramework.drawio (1)" style="zoom: 25%;" /> 



**交互设计**

交互安排遵循奥卡姆剃刀原则(如无必要，勿增实体)

将所有用户交互操作归一化到统一的鼠标操作中，这样做有两点好处：

1. 最小化学习成本

   考虑到用户群像中，低龄和轻度游戏用户占比相对较高，尽可能降低学习成本，提高操作直觉性是十分关键的。将操作统一到点击以最小化用户对于交互的学习成本，方便快速上手并进入心流循环。

2. 多平台迁移拓展能力

​	方便游戏的跨平台迁移能力，我们的游戏因此能够同时在PC端，Web端和Android端（手机端还没做好）运行。尤其是手机端上游戏，对于操作简化度的重视水平是远高于PC端的。

<img src="Images\interact.drawio.png" alt="interact.drawio" style="zoom:50%;" /> <img src="Images\interact2.drawio.png" alt="interact2.drawio" style="zoom: 50%;" />

左：冗余交互量系统

右：归一化交互系统



### 游戏概念

见：游戏框架与概念概述



### 物理模拟实现(数学模型推导)

**力学：**

使用Unity物理系统中的锚点系统(Hinge Joint)实现，该系统模拟了物体环绕特定锚点摆臂的效果，也实现了天平的力臂模拟。

//这段用的是源生系统，没有什么特别多值得吹的点。

//但是可以提到磁学里的离散多采样点模拟设计："使用离散多采样点模拟刚体受不均匀力的效果，具体使用在磁学章细讲"



Unity源生物理系统中的力矩计算公式：(我们并没有实现这个，这是是Unity自带的)

$\tau = I \cdot \alpha + \vec{\omega} \times (I \cdot \vec{\omega})$

*τ*：作用在铰链轴上的净扭矩

*I*：刚体的惯性张量（取决于 `Rigidbody.mass` 和碰撞体形状）

*α*：角加速度

*ω*：当前角速度



**光学**

反射公式

$\mathbf{d}_{i+1} = \mathbf{d}_i - 2(\mathbf{d}_i \cdot \mathbf{n}_i)\mathbf{n}_i$

$\mathbf{d}_i$ 为第i次反射前的归一化方向向量

$\mathbf{n}_i $为碰撞表面的法线向量

$\mathbf{d}_{i+1}$ 为反射后的新方向向量

// 图形学经典公式（虽然我早忘了）



路径递推公式

$\begin{cases}
P_{k+1} = P_k + t_k\mathbf{d}_k + \varepsilon\mathbf{d}_{k+1} \\
t_{k+1} = t_k - \|P_{k+1} - P_k\| 
\end{cases}$

$P_k$ 为第k段光线的起点

$t_k$ 为剩余传播距离

$\varepsilon$ 为微小偏移量（代码中取0.001）

//人话版本: 每次投射光线的时候要一个剩余传播距离参数d，即传播总长度超过d就不传了，避免无限反射导致死循环游戏卡死。

//每次反射时找到下一次反射的目标点，然后计算距离$d_{k+1}$，确保总长度不超过阈值。



路径终止条件

$\begin{cases}
\sum_{i=0}^{m} \|P_{i+1}-P_i\| \geq 1000 \\
m \geq 5 \\
\exists\ k \in [0,m],\ \text{InteractionType}(S_k) = \text{Stop}
\end{cases}$

$m$ 为当前反射次数

$S_k$为第k次碰撞的物体表面

//人话：当光线走了1000m远，或者反射了5次，或者碰到了一个InteractionType标签为Stop的物体时，光线停止在这，不接着算了。



光线汇总公式

$\mathcal{L} = \bigcup_{k=0}^{n} \{ P_k + t\mathbf{d}_k \ | \ t \in [0, \|P_{k+1}-P_k\|] \}$

//人话：把每一个反射的路径加一块。



**磁学**

前置：库仑力公式

我们使用库仑力来模拟玩家创建的磁场和磁性物体之间的吸引力。

$F = \frac {k·(q_1q_2)}{r²}$

游戏模拟中，省略了$q_1$,$q_2$参数，理想化为1，并使用响应度矩阵$T_{xy}$替代

响应度矩阵的作用在后文提及

//人话：直接用k/r^2算磁力，然后F在x方向和y方向的力各自乘上一个修正量，让有些物体在x方向上受到的磁力和y方向上受到的磁力不一样



磁力模拟：**离散多采样点模拟**

对于具有一定体积的刚体，其在磁场中的不均匀受力效果会很不一致

而公式中r的值在计算机中模拟为"物体坐标中心到磁场中心的距离，这将导致对于条状物体，力的反馈并不符合实际"

离散点采样将物体的受力部分分散到给定的采样锚点中，磁场改为对离散点作用，并将作用结果加权平均后反馈到主物体身上

//人话：给物体上加几个点，每个点各自计算磁力，然后加一块给物体addForce



总磁力公式

$\frac{1}{n}\sum_{i=1}^{n} \left( \text{clamp}\left( \frac{k_{magnet}}{r_i^2}, F_{min}, F_{max} \right) \cdot \hat{\vec{r}}_i \right) $

$n: 锚点数量 $ 
$k_{magnet}: 磁力系数（forceFactor） $ 
$r_i: 第i个锚点到磁源的距离 $
$\hat{\vec{r}}_i: 第i个锚点指向磁源的单位方向向量$  
$F_{min}/F_{max}: 磁力最小/最大值  $

clamp函数的作用是将磁力限制在一定区间内，最大值的存在时因为在计算机模拟中，$r_i^2$在玩家鼠标和物体十分靠近时变得极小，可能导致力度爆炸的问题（F突变至数千甚至数万），最小值的存在是为了让用户在物体进入磁力范围内能够得到一个更加准确的反馈进行判断。

//人话：把所有锚点受力加一块平均，受力的时候限制一下最大值。



阻尼力：

$\text{clamp}\left( -k_{damp} \cdot \vec{v}, 0, F_{damp\_max} \right)$

阻尼力的存在是为了模拟现实生活的空气阻力，因为在计算机模拟的理想物理状态下，当我们去吸引一个物体时，它的惯性会导致它在磁场附近震荡而不会稳定到合适的位置。而在解谜游戏设计中需要玩家能够较好地控制物体地稳定性，因此阻尼力对物体的受力提供了一个始终反向于速度的阻尼力，降低物体总能量以保证最终的稳定态。

//人话：不加空气阻力物体会一直晃，停不下来



响应度矩阵$T_{xy}$

$T_{xy} = \begin{bmatrix} \tau_1 & \tau_2 & \cdots & \tau_n \end{bmatrix} \in \mathbb{R}^{1\times n}$

响应度矩阵是我们特别提出的一种修正设计，用于替代原磁力公式中$q_1,q_2$，它表达了一个磁力物体对n维（游戏中n=2）的磁场力的响应水平。

响应度矩阵可以针对x和y方向进行不同水平的响应度分解，在游戏中的圆形磁体就利用了这一设计将y方向的磁力响应水平降低。这一设计的目的是保持游戏物理模拟专业性的同时，提高游戏谜题的可拓展性。

$F_{\text{modified}} = \left(k\frac{1}{r^2}\right) \odot T_{xy}$

//人话：给力在每个方向的值都乘上一个修正量$\tau_i$，比如我想让他只会受原始磁力水平方向的0.5倍，那就矩阵第一项为0.5，第二项为0



最终总公式：

$\vec{F}_{total} = \frac{1}{n}\sum_{i=1}^{n} \left( \text{clamp}\left( \frac{k_{magnet}}{r_i^2}, F_{min}, F_{max} \right) \cdot \hat{\vec{r}}_i \right) + \text{clamp}\left( -k_{damp} \cdot \vec{v}, 0, F_{damp\_max} \right)$

$n: 锚点数量 $ 
$k_{magnet}: 磁力系数（forceFactor） $ 
$r_i: 第i个锚点到磁源的距离 $
$\hat{\vec{r}}_i: 第i个锚点指向磁源的单位方向向量$  
$F_{min}/F_{max}: 磁力最小/最大值  $
$k_{damp}: 阻尼系数 $
$\vec{v}: 物体运动速度  $
$F_{damp\_max}: 最大阻尼力$
$\text{clamp}(x,a,b): 限制函数，将x限制在区间[a,b]内$